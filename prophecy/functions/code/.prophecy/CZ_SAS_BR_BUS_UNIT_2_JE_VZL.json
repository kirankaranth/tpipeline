{"initCode": "", "code": "\"\"\" UDF \"\"\"\n\n# RULE_PARMS: BUSINESS_UNIT_CODE\n# RULE_NAME:  BR_BUS_UNIT_2_JE_VZL\n# RULE_CODE:  \"case when &BUSINESS_UNIT_CODE = 'CC411'\n#                   then '0004.12'\n#                   when &BUSINESS_UNIT_CODE = 'CR852'\n#                   then '0008.21'\n#                   when &BUSINESS_UNIT_CODE = 'CM852'\n#                   then '0008.24'\n#                   when catx('.',\n#                             %br_edwh(BR_BUS_UNIT_2_JUR_ENT, &BUSINESS_UNIT_CODE),\n#                             substr(&BUSINESS_UNIT_CODE,4,2))\n#                       in ('0004.11' '0008.52' '0010.11' '0010.52' '0020.11' '0020.52' '0021.11')\n#                   then catx('.',\n#                             %br_edwh(BR_BUS_UNIT_2_JUR_ENT, &BUSINESS_UNIT_CODE),\n#                             substr(&BUSINESS_UNIT_CODE,4,2))\n#                   else '' end\"\n# RULE_TEXT:  Bepaal JE_VZL_COMBI_CODE aan de hand van business unit code\n# RULE_TEXT eng: Determine JE_VZL_COMBI_CODE based on business unit code\n\nfrom pyspark.sql.functions import udf\nfrom pyspark.sql.types import StringType\n\n\n@udf(returnType=StringType())\ndef cz_sas_br_bus_unit_2_je_vzl(business_unit_code: str) -> str:\n    def br_bus_unit_2_jur_ent(business_unit_code):\n        if business_unit_code is not None:\n            if len(business_unit_code) >= 5:\n                if business_unit_code[4].isdigit():\n                    if business_unit_code[:3] == \"CZZ\":\n                        return \"0004\"\n                    if not business_unit_code[2].isdigit():\n                        return \"\"\n                    if business_unit_code[1].isdigit():\n                        business_code_part = int(business_unit_code[1:3])\n                        return f\"{business_code_part:04d}\"\n                    business_code_part = int(business_unit_code[2:3])\n                    return f\"{business_code_part:04d}\"\n        return \"\"\n\n    if business_unit_code is not None:\n        if business_unit_code == \"CC411\":\n            return \"0004.12\"\n\n        if business_unit_code == \"CR852\":\n            return \"0008.21\"\n\n        if business_unit_code == \"CM852\":\n            return \"0008.24\"\n\n        if br_bus_unit_2_jur_ent(business_unit_code) + \".\" + business_unit_code[\n            3:5\n        ] in (\n            \"0004.11\",\n            \"0008.52\",\n            \"0010.11\",\n            \"0010.52\",\n            \"0020.11\",\n            \"0020.52\",\n            \"0021.11\",\n        ):\n            return (\n                br_bus_unit_2_jur_ent(business_unit_code)\n                + \".\"\n                + business_unit_code[3:5]\n            )\n\n    return \"\"\n"}